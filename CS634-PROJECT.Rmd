---
title: "CS634-Project"
author: "XiruiGuan"
date: "2023-12-09"
output: html_document
---

```{r, include=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
library(tree)
library(glmnet)
library(randomForest)
library(nnet)
library(irr)
library(e1071)
library(reshape2)
library(stats)
```

read the data and combine them into one
```{r,message=FALSE}
df1 <- read_csv("Nhanes_2005_2006.csv")
df2 <- read_csv("Nhanes_2007_2008.csv")
df3 <- read_csv("Nhanes_2009_2010.csv")
df4 <- read_csv("Nhanes_2011_2012.csv")
df5 <- read_csv("Nhanes_2013_2014.csv")
df <- bind_rows(df1, df2, df3, df4, df5)
```

clean the row and columns
```{r}
cleaned_df <- df[!is.na(df$DRD350B) & !is.na(df$DRD350C), ]
columnIndex <- which(names(cleaned_df) == "DRD370UQ")
cleaned_df <- cleaned_df[, 1:columnIndex]
cleaned_df <- replace(cleaned_df, is.na(cleaned_df), 0)
```

combine the quantity of the seafood
```{r}
seafoodq <- data.frame(cleaned_df$SEQN)
seafoodq$shellfish <- cleaned_df$DRD350AQ + cleaned_df$DRD350EQ + cleaned_df$DRD350FQ + cleaned_df$DRD350GQ + cleaned_df$DRD350IQ
seafoodq$shrimp_crab <- cleaned_df$DRD350CQ + cleaned_df$DRD350DQ + cleaned_df$DRD350HQ
seafoodq$seafish <- cleaned_df$DRD370BQ + cleaned_df$DRD370EQ + cleaned_df$DRD370FQ + cleaned_df$DRD370GQ + cleaned_df$DRD370HQ + cleaned_df$DRD370JQ + cleaned_df$DRD370KQ + cleaned_df$DRD370NQ
seafoodq$freshwaterfish <- cleaned_df$DRD370CQ + cleaned_df$DRD370DQ + cleaned_df$DRD370IQ + cleaned_df$DRD370MQ + cleaned_df$DRD370OQ + cleaned_df$DRD370RQ
```

```{r,message=FALSE}
sub_df <- cleaned_df[c("SEQN","DR1TKCAL","DR1TPROT","DR1TCARB","DR1TTFAT","DR1TFIBE","DR1TIRON","DR1TCALC","DR1TZINC","DR1TPOTA")]
sub_df<-cbind(sub_df,seafoodq[,2:5])
```

rename the useful Y column and calculate the relationship between them
```{r}
names(sub_df)[names(sub_df) == c("SEQN","DR1TKCAL","DR1TPROT","DR1TCARB","DR1TTFAT","DR1TFIBE","DR1TIRON","DR1TCALC","DR1TZINC","DR1TPOTA")]<-c("ID","Energy","Protein","Carbohydrate","Fat","Fiber","Iron","Calcium","Zinc","Potassium")
sub_df$Protein_kcal <- sub_df$Protein * 4
sub_df$Carbohydrate_kcal <- sub_df$Carbohydrate * 4
sub_df$Fat_kcal <- sub_df$Fat * 9
sub_df$Protein_p <- (sub_df$Protein_kcal/sub_df$Energy)*100
sub_df$Carbohydrate_p <- (sub_df$Carbohydrate_kcal/sub_df$Energy)*100
sub_df$Fat_p <- (sub_df$Fat_kcal/sub_df$Energy)*100
sub_df<- na.omit(sub_df)
```


```{r}
sub_df$Protein_balance <- "Balance"
for (i in 1:nrow(sub_df)){ 
   if (sub_df$Protein_p[i] < 10) {
    sub_df$Protein_balance[i]<- "Low"
   }
   if (sub_df$Protein_p[i] > 25) {
    sub_df$Protein_balance[i]<- "High"
  }
}
```


```{r}
sub_df$Carbohydrate_balance <- "Balance"
for (i in 1:nrow(sub_df)){ 
   if (sub_df$Carbohydrate_p[i] < 45) {
    sub_df$Carbohydrate_balance[i]<- "Low"
   }
   if (sub_df$Carbohydrate_p[i] > 65) {
    sub_df$Carbohydrate_balance[i]<- "High"
  }
}
```


```{r}
sub_df$Fat_balance <-"Balance"
for (i in 1:nrow(sub_df)){ 
   if (sub_df$Fat_p[i] < 45) {
    sub_df$Fat_balance[i]<- "Low"
   }
   if (sub_df$Fat_p[i] > 65) {
    sub_df$Fat_balance[i]<- "High"
  }
}
```


```{r}
train_indices <- sample(1:nrow(sub_df), 0.8 * nrow(sub_df))
train_data <- sub_df[train_indices, ]
test_data <- sub_df[-train_indices, ]
```


```{r}
train_data$Protein_balance<-as.factor(train_data$Protein_balance)
test_data$Protein_balance<-as.factor(test_data$Protein_balance)
rf_model_Protein<- randomForest(Protein_balance ~ shrimp_crab+seafish+freshwaterfish,data=train_data,ntree = 50, mtry = 4)
predictions_Protein <- predict(rf_model_Protein, newdata = test_data)
conf_matrix_Protein <- table(predictions_Protein, test_data$Protein_balance)
print(conf_matrix_Protein)
correct_predictions <- sum(diag(conf_matrix_Protein))
total_predictions <- sum(conf_matrix_Protein)
accuracy <- correct_predictions / total_predictions
print(paste("Accuracy:", accuracy))

```



```{r}
train_data$Carbohydrate_balance<-as.factor(train_data$Carbohydrate_balance)
test_data$Carbohydrate_balance<-as.factor(test_data$Carbohydrate_balance)
rf_model_Carbohydrate<- randomForest(Carbohydrate_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish,data=train_data,ntree = 50, mtry = 4)
predictions_Carbohydrate <- predict(rf_model_Carbohydrate, newdata = test_data)
conf_matrix_Carbohydrate <- table(predictions_Carbohydrate, test_data$Carbohydrate_balance)
print(conf_matrix_Carbohydrate)
correct_predictions <- sum(diag(conf_matrix_Carbohydrate))
total_predictions <- sum(conf_matrix_Carbohydrate)
accuracy <- correct_predictions / total_predictions
print(paste("Accuracy:", accuracy))
```


```{r}
train_data$Fat_balance<-as.factor(train_data$Fat_balance)
test_data$Fat_balance<-as.factor(test_data$Fat_balance)
rf_model_Fat<- randomForest(Fat_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish,data=train_data,ntree = 50, mtry = 4)
predictions_Fat <- predict(rf_model_Fat, newdata = test_data)
conf_matrix_Fat <- table(predictions_Fat, test_data$Fat_balance)
print(conf_matrix_Fat)
correct_predictions <- sum(diag(conf_matrix_Fat))
total_predictions <- sum(conf_matrix_Fat)
accuracy <- correct_predictions / total_predictions
print(paste("Accuracy:", accuracy))
```


```{r}
train_data$Protein_balance_1<-as.numeric(train_data$Protein_balance == "Low")
test_data$Protein_balance_1<- as.numeric(test_data$Protein_balance == "Low")
Protein_logistic_model_1 <- glm(Protein_balance_1 ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data,family = "binomial",weights = ifelse(train_data$Protein_balance_1 == 0, 1,8.4))
Protein_logistic_predictions_1 <- predict(Protein_logistic_model_1, newdata = test_data, type = "response")
threshold <- 0.5
Protein_binary_predictions_1 <- ifelse(Protein_logistic_predictions_1 < threshold, 0,1)
conf_matrix_Protein_logistic_1 <- table(Protein_binary_predictions_1, test_data$Protein_balance_1)
print(conf_matrix_Protein_logistic_1)
```

```{r}
train_data$Protein_balance_2<-as.numeric(train_data$Protein_balance == "High")
test_data$Protein_balance_2<-as.numeric(test_data$Protein_balance == "High")
Protein_logistic_model_2 <- glm(Protein_balance_2 ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data,family = "binomial",weights = ifelse(train_data$Protein_balance_2 == 0, 1,12))
Protein_logistic_predictions_2 <- predict(Protein_logistic_model_2, newdata = test_data, type = "response")
Protein_binary_predictions_2 <- ifelse(Protein_logistic_predictions_2 < threshold, 0,1)
conf_matrix_Protein_logistic_2 <- table(Protein_binary_predictions_2, test_data$Protein_balance_2)
print(conf_matrix_Protein_logistic_2)
```

```{r}
train_data$Protein_balance_3<-as.numeric(train_data$Protein_balance == "Balance")
test_data$Protein_balance_3<-as.numeric(test_data$Protein_balance == "Balance")
Protein_logistic_model_3 <- glm(Protein_balance_3 ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data,family = "binomial",weights = ifelse(train_data$Protein_balance_3 == 0, 5.5,1))
Protein_logistic_predictions_3 <- predict(Protein_logistic_model_3, newdata = test_data, type = "response")
Protein_binary_predictions_3 <- ifelse(Protein_logistic_predictions_3 < 0.5, 0,1)
conf_matrix_Protein_logistic_3 <- table(Protein_binary_predictions_3, test_data$Protein_balance_3)
print(conf_matrix_Protein_logistic_3)
```

```{r}
train_data$weight <- 1
for (i in 1:nrow(train_data)){ 
   if (train_data$Protein_balance[i] == "High") {
    train_data$weight[i]<- 10
   }
   if (train_data$Protein_balance[i] == "Low") {
    train_data$weight[i]<- 8
  }
} 
logistic_model <- multinom(Protein_balance~shellfish+shrimp_crab+seafish+freshwaterfish, data = train_data, weight =train_data$weight)
logistic_predictions <- predict(logistic_model, newdata = test_data)
conf_matrix_logistic <- table(logistic_predictions, test_data$Protein_balance)
print(conf_matrix_logistic)
sum(logistic_predictions==test_data$Protein_balance)/(nrow(test_data))
```



```stop`````
```{r}
train_data$Carbohydrate_balance_1<-as.numeric(train_data$Carbohydrate_balance == "Low")
test_data$Carbohydrate_balance_1<- as.numeric(test_data$Carbohydrate_balance == "Low")
Carbohydrate_logistic_model_1 <- glm(Carbohydrate_balance_1 ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data,family = "binomial",weights = ifelse(train_data$Carbohydrate_balance_1 == 0, 1,8.4))
Carbohydrate_logistic_predictions_1 <- predict(Carbohydrate_logistic_model_1, newdata = test_data, type = "response")
threshold <- 0.5
Carbohydrate_binary_predictions_1 <- ifelse(Carbohydrate_logistic_predictions_1 < threshold, 0,1)
conf_matrix_Carbohydrate_logistic_1 <- table(Carbohydrate_binary_predictions_1, test_data$Carbohydrate_balance_1)
print(conf_matrix_Carbohydrate_logistic_1)
```

```{r}
train_data$Carbohydrate_balance_2<-as.numeric(train_data$Carbohydrate_balance == "High")
test_data$Carbohydrate_balance_2<-as.numeric(test_data$Carbohydrate_balance == "High")
Carbohydrate_logistic_model_2 <- glm(Carbohydrate_balance_2 ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data,family = "binomial",weights = ifelse(train_data$Carbohydrate_balance_2 == 0, 1,12))
Carbohydrate_logistic_predictions_2 <- predict(Carbohydrate_logistic_model_2, newdata = test_data, type = "response")
Carbohydrate_binary_predictions_2 <- ifelse(Carbohydrate_logistic_predictions_2 < threshold, 0,1)
conf_matrix_Carbohydrate_logistic_2 <- table(Carbohydrate_binary_predictions_2, test_data$Carbohydrate_balance_2)
print(conf_matrix_Carbohydrate_logistic_2)
```

```{r}
train_data$Carbohydrate_balance_3<-as.numeric(train_data$Carbohydrate_balance == "Balance")
test_data$Carbohydrate_balance_3<-as.numeric(test_data$Carbohydrate_balance == "Balance")
Carbohydrate_logistic_model_3 <- glm(Carbohydrate_balance_3 ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data,family = "binomial",weights = ifelse(train_data$Carbohydrate_balance_3 == 0, 5.5,1))
Carbohydrate_logistic_predictions_3 <- predict(Carbohydrate_logistic_model_3, newdata = test_data, type = "response")
Carbohydrate_binary_predictions_3 <- ifelse(Carbohydrate_logistic_predictions_3 < 0.5, 0,1)
conf_matrix_Carbohydrate_logistic_3 <- table(Carbohydrate_binary_predictions_3, test_data$Carbohydrate_balance_3)
print(conf_matrix_Carbohydrate_logistic_3)
```

```{r}
train_data$weight <- 1
for (i in 1:nrow(train_data)){ 
   if (train_data$Carbohydrate_balance[i] == "High") {
    train_data$weight[i]<- 10
   }
   if (train_data$Carbohydrate_balance[i] == "Low") {
    train_data$weight[i]<- 8
  }
} 
logistic_model <- multinom(Carbohydrate_balance~shellfish+shrimp_crab+seafish+freshwaterfish, data = train_data, weight =train_data$weight)
logistic_predictions <- predict(logistic_model, newdata = test_data)
conf_matrix_logistic <- table(logistic_predictions, test_data$Carbohydrate_balance)
print(conf_matrix_logistic)
sum(logistic_predictions==test_data$Carbohydrate_balance)/(nrow(test_data))
```

```{r}
train_data$Fat_balance_1<-as.numeric(train_data$Fat_balance == "Low")
test_data$Fat_balance_1<- as.numeric(test_data$Fat_balance == "Low")
Fat_logistic_model_1 <- glm(Fat_balance_1 ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data,family = "binomial",weights = ifelse(train_data$Fat_balance_1 == 0, 1,8.4))
Fat_logistic_predictions_1 <- predict(Fat_logistic_model_1, newdata = test_data, type = "response")
threshold <- 0.5
Fat_binary_predictions_1 <- ifelse(Fat_logistic_predictions_1 < threshold, 0,1)
conf_matrix_Fat_logistic_1 <- table(Fat_binary_predictions_1, test_data$Fat_balance_1)
print(conf_matrix_Fat_logistic_1)
```

```{r}
train_data$Fat_balance_2<-as.numeric(train_data$Fat_balance == "High")
test_data$Fat_balance_2<-as.numeric(test_data$Fat_balance == "High")
Fat_logistic_model_2 <- glm(Fat_balance_2 ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data,family = "binomial",weights = ifelse(train_data$Fat_balance_2 == 0, 1,12))
Fat_logistic_predictions_2 <- predict(Fat_logistic_model_2, newdata = test_data, type = "response")
Fat_binary_predictions_2 <- ifelse(Fat_logistic_predictions_2 < threshold, 0,1)
conf_matrix_Fat_logistic_2 <- table(Fat_binary_predictions_2, test_data$Fat_balance_2)
print(conf_matrix_Fat_logistic_2)
```

```{r}
train_data$Fat_balance_3<-as.numeric(train_data$Fat_balance == "Balance")
test_data$Fat_balance_3<-as.numeric(test_data$Fat_balance == "Balance")
Fat_logistic_model_3 <- glm(Fat_balance_3 ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data,family = "binomial",weights = ifelse(train_data$Fat_balance_3 == 0, 5.5,1))
Fat_logistic_predictions_3 <- predict(Fat_logistic_model_3, newdata = test_data, type = "response")
Fat_binary_predictions_3 <- ifelse(Fat_logistic_predictions_3 < 0.5, 0,1)
conf_matrix_Fat_logistic_3 <- table(Fat_binary_predictions_3, test_data$Fat_balance_3)
print(conf_matrix_Fat_logistic_3)
```

```{r}
train_data$weight <- 1
for (i in 1:nrow(train_data)){ 
   if (train_data$Fat_balance[i] == "High") {
    train_data$weight[i]<- 10
   }
   if (train_data$Fat_balance[i] == "Low") {
    train_data$weight[i]<- 8
  }
} 
logistic_model <- multinom(Fat_balance~shellfish+shrimp_crab+seafish+freshwaterfish, data = train_data, weight =train_data$weight)
logistic_predictions <- predict(logistic_model, newdata = test_data)
conf_matrix_logistic <- table(logistic_predictions, test_data$Fat_balance)
print(conf_matrix_logistic)
sum(logistic_predictions==test_data$Fat_balance)/(nrow(test_data))
```
````here```````


Get variables for second Y

```{r}
sub_df$Fiber_balance <- "Balance"
for (i in 1:nrow(sub_df)){ 
   if (sub_df$Fiber[i] < 10) {
    sub_df$Fiber_balance[i]<- "Low"
   }
   if (sub_df$Fiber[i] > 40) {
    sub_df$Fiber_balance[i]<- "High"
  }
}
```


```{r}
sub_df$Iron_balance <- "Balance"
for (i in 1:nrow(sub_df)){ 
   if (sub_df$Iron[i] < 10) {
    sub_df$Iron_balance[i]<- "Low"
   }
   if (sub_df$Iron[i] > 40) {
    sub_df$Iron_balance[i]<- "High"
  }
}
```


```{r}
sub_df$Calcium_balance <-"Balance"
for (i in 1:nrow(sub_df)){ 
   if (sub_df$Calcium[i] < 800) {
    sub_df$Calcium_balance[i]<- "Low"
   }
   if (sub_df$Calcium[i] > 2500) {
    sub_df$Calcium_balance[i]<- "High"
  }
}
```

```{r}
sub_df$Potassium_balance <-"Balance"
for (i in 1:nrow(sub_df)){ 
   if (sub_df$Potassium[i] < 2000) {
    sub_df$Potassium_balance[i]<- "Low"
   }
   if (sub_df$Potassium[i] > 3500) {
    sub_df$Potassium_balance[i]<- "High"
  }
}
```

```{r}
sub_df$Zinc_balance <-"Balance"
for (i in 1:nrow(sub_df)){ 
   if (sub_df$Zinc[i] < 8) {
    sub_df$Zinc_balance[i]<- "Low"
   }
   if (sub_df$Zinc[i] > 20) {
    sub_df$Zinc_balance[i]<- "High"
  }
}
```

```{r}
train_indices <- sample(1:nrow(sub_df), 0.8 * nrow(sub_df))
train_data <- sub_df[train_indices, ]
test_data <- sub_df[-train_indices, ]
```
Zinc --- Random Forest
```{r}
train_data$Zinc_balance<-as.factor(train_data$Zinc_balance)
test_data$Zinc_balance<-as.factor(test_data$Zinc_balance)
rf_model_Zinc<- randomForest(Zinc_balance ~ shrimp_crab+freshwaterfish,data=train_data,ntree = 50, mtry = 4)
predictions_Zinc <- predict(rf_model_Zinc, newdata = test_data)
conf_matrix_Zinc <- table(predictions_Zinc, test_data$Zinc_balance)
print(conf_matrix_Zinc)
correct_predictions <- sum(diag(conf_matrix_Zinc))
total_predictions <- sum(conf_matrix_Zinc)
accuracy <- correct_predictions / total_predictions
print(paste("Accuracy:", accuracy))
predictions <- predict(rf_model_Zinc, newdata = test_data)
conf_matrix <- table(test_data$Zinc_balance, predictions)
kappa_stat <- kappam.fleiss(conf_matrix)$value
print(paste("kappa:", kappa_stat))
```

Zinc --- logistic 
```{r}
train_data$Zinc_weight <- 1
for (i in 1:nrow(train_data)){ 
   if (train_data$Zinc_balance[i] == "High") {
    train_data$Zinc_weight[i]<- 6.5
   }
   if (train_data$Zinc_balance[i] == "Low") {
    train_data$Zinc_weight[i]<- 2
  }
} 
Zinc_logistic_model <- multinom(Zinc_balance~shrimp_crab+freshwaterfish, data = train_data, weight =train_data$Zinc_weight)
Zinc_logistic_predictions <- predict(Zinc_logistic_model, newdata = test_data)
Zinc_conf_matrix_logistic <- table(Zinc_logistic_predictions, test_data$Zinc_balance)
print(Zinc_conf_matrix_logistic)
print(paste("Accurate:",1-sum(Zinc_logistic_predictions==test_data$Zinc_balance)/(nrow(test_data))))
predictions <- predict(Zinc_logistic_model, newdata = test_data)
conf_matrix <- table(test_data$Zinc_balance, predictions)
kappa_stat <- kappam.fleiss(conf_matrix)$value
print(paste("kappa:", kappa_stat))
```

Zinc --- Naive Bayes
```{r}
Zinc_naive_bayes <- naiveBayes(Zinc_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data)
Zinc_nb_predictions <- predict(Zinc_naive_bayes, newdata = test_data)
Zinc_conf_matrix <- table(Zinc_nb_predictions, test_data$Zinc_balance)
sum(diag(Zinc_conf_matrix)) / sum(Zinc_conf_matrix)
print(Zinc_conf_matrix)
```

Zinc --- SVM
```{r}
Zinc_weights <- c(Balance = 1, High = 6.5, Low = 2)
Zinc_svm_model <- svm(Zinc_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish, data = train_data, kernel = "radial", type = "C-classification",class.weights = Zinc_weights)
Zinc_svm_predictions <- predict(Zinc_svm_model, newdata = test_data)
Zinc_svm_accuracy <- sum(Zinc_svm_predictions == test_data$Zinc_balance) / nrow(test_data)
table(Zinc_svm_predictions,test_data$Zinc_balance)
print(Zinc_svm_accuracy)
```


Fiber --- Random Forest
```{r}
train_data$Fiber_balance<-as.factor(train_data$Fiber_balance)
test_data$Fiber_balance<-as.factor(test_data$Fiber_balance)
rf_model_Fiber<- randomForest(Fiber_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish,data=train_data,ntree = 50, mtry = 4)
predictions_Fiber <- predict(rf_model_Fiber, newdata = test_data)
conf_matrix_Fiber <- table(predictions_Fiber, test_data$Fiber_balance)
print(conf_matrix_Fiber)
accuracy_Fiber <- sum(diag(conf_matrix_Fiber)) / sum(conf_matrix_Fiber)
print(paste("Accuracy:", accuracy_Fiber))
```

Fiber --- logistic 
```{r}
train_data$Fiber_weight <- 1
for (i in 1:nrow(train_data)){ 
   if (train_data$Fiber_balance[i] == "High") {
    train_data$Fiber_weight[i]<- 6.5
   }
   if (train_data$Fiber_balance[i] == "Low") {
    train_data$Fiber_weight[i]<- 2
  }
} 
Fiber_logistic_model <- multinom(Fiber_balance~shellfish+shrimp_crab+seafish+freshwaterfish, data = train_data, weight =train_data$Fiber_weight)
Fiber_logistic_predictions <- predict(Fiber_logistic_model, newdata = test_data)
Fiber_conf_matrix_logistic <- table(Fiber_logistic_predictions, test_data$Fiber_balance)
print(Fiber_conf_matrix_logistic)
sum(Fiber_logistic_predictions==test_data$Fiber_balance)/(nrow(test_data))
```

Fiber --- Naive Bayes
```{r}
Fiber_naive_bayes <- naiveBayes(Fiber_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data)
Fiber_nb_predictions <- predict(Fiber_naive_bayes, newdata = test_data)
Fiber_conf_matrix <- table(Fiber_nb_predictions, test_data$Fiber_balance)
sum(diag(Fiber_conf_matrix)) / sum(Fiber_conf_matrix)
print(Fiber_conf_matrix)
```

Fiber --- SVM
```{r}
Fiber_weights <- c(Balance = 1, High = 6.5, Low = 2)
Fiber_svm_model <- svm(Fiber_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish, data = train_data, kernel = "radial", type = "C-classification",class.weights = Fiber_weights)
Fiber_svm_predictions <- predict(Fiber_svm_model, newdata = test_data)
Fiber_svm_accuracy <- sum(Fiber_svm_predictions == test_data$Fiber_balance) / nrow(test_data)
table(Fiber_svm_predictions,test_data$Fiber_balance)
print(Fiber_svm_accuracy)
```

Iron --- rf
```{r}
train_data$Iron_balance<-as.factor(train_data$Iron_balance)
test_data$Iron_balance<-as.factor(test_data$Iron_balance)
rf_model_Iron<- randomForest(Iron_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish,data=train_data,ntree = 50, mtry = 4)
predictions_Iron <- predict(rf_model_Iron, newdata = test_data)
conf_matrix_Iron <- table(predictions_Iron, test_data$Iron_balance)
print(conf_matrix_Iron)
correct_predictions <- sum(diag(conf_matrix_Iron))
total_predictions <- sum(conf_matrix_Iron)
accuracy <- correct_predictions / total_predictions
print(paste("Accuracy:", accuracy))
```


Iron --- logistic 
```{r}
train_data$Iron_weight <- 1
for (i in 1:nrow(train_data)){ 
   if (train_data$Iron_balance[i] == "High") {
    train_data$Iron_weight[i]<- 6.5
   }
   if (train_data$Iron_balance[i] == "Low") {
    train_data$Iron_weight[i]<- 2
  }
} 
Iron_logistic_model <- multinom(Iron_balance~shellfish+shrimp_crab+seafish+freshwaterfish, data = train_data, weight =train_data$Iron_weight)
Iron_logistic_predictions <- predict(Iron_logistic_model, newdata = test_data)
Iron_conf_matrix_logistic <- table(Iron_logistic_predictions, test_data$Iron_balance)
print(Iron_conf_matrix_logistic)
sum(Iron_logistic_predictions==test_data$Iron_balance)/(nrow(test_data))
```

Iron --- Naive Bayes
```{r}
Iron_naive_bayes <- naiveBayes(Iron_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data)
Iron_nb_predictions <- predict(Iron_naive_bayes, newdata = test_data)
Iron_conf_matrix <- table(Iron_nb_predictions, test_data$Iron_balance)
sum(diag(Iron_conf_matrix)) / sum(Iron_conf_matrix)
print(Iron_conf_matrix)
```

Iron --- SVM
```{r}
Iron_weights <- c(Balance = 1, High = 6.5, Low = 2)
Iron_svm_model <- svm(Iron_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish, data = train_data, kernel = "radial", type = "C-classification",class.weights = Iron_weights)
Iron_svm_predictions <- predict(Iron_svm_model, newdata = test_data)
Iron_svm_accuracy <- sum(Iron_svm_predictions == test_data$Iron_balance) / nrow(test_data)
table(Iron_svm_predictions,test_data$Iron_balance)
print(Iron_svm_accuracy)
```


Calcium --- Random Forest
```{r}
train_data$Calcium_balance<-as.factor(train_data$Calcium_balance)
test_data$Calcium_balance<-as.factor(test_data$Calcium_balance)
rf_model_Calcium<- randomForest(Calcium_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish,data=train_data,ntree = 50, mtry = 4)
predictions_Calcium <- predict(rf_model_Calcium, newdata = test_data)
conf_matrix_Calcium <- table(predictions_Calcium, test_data$Calcium_balance)
print(conf_matrix_Calcium)
correct_predictions <- sum(diag(conf_matrix_Calcium))
total_predictions <- sum(conf_matrix_Calcium)
accuracy <- correct_predictions / total_predictions
print(paste("Accuracy:", accuracy))
```

Calcium --- logistic 
```{r}
train_data$Calcium_weight <- 1
for (i in 1:nrow(train_data)){ 
   if (train_data$Calcium_balance[i] == "High") {
    train_data$Calcium_weight[i]<- 6.5
   }
   if (train_data$Calcium_balance[i] == "Low") {
    train_data$Calcium_weight[i]<- 2
  }
} 
Calcium_logistic_model <- multinom(Calcium_balance~shellfish+shrimp_crab+seafish+freshwaterfish, data = train_data, weight =train_data$Calcium_weight)
Calcium_logistic_predictions <- predict(Calcium_logistic_model, newdata = test_data)
Calcium_conf_matrix_logistic <- table(Calcium_logistic_predictions, test_data$Calcium_balance)
print(Calcium_conf_matrix_logistic)
sum(Calcium_logistic_predictions==test_data$Calcium_balance)/(nrow(test_data))
```

Calcium --- Naive Bayes
```{r}
Calcium_naive_bayes <- naiveBayes(Calcium_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data)
Calcium_nb_predictions <- predict(Calcium_naive_bayes, newdata = test_data)
Calcium_conf_matrix <- table(Calcium_nb_predictions, test_data$Calcium_balance)
sum(diag(Calcium_conf_matrix)) / sum(Calcium_conf_matrix)
print(Calcium_conf_matrix)
```

Calcium --- SVM
```{r}
Calcium_weights <- c(Balance = 8, High = 1, Low = 3)
Calcium_svm_model <- svm(Calcium_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish, data = train_data, kernel = "radial", type = "C-classification",class.weights = Calcium_weights)
Calcium_svm_predictions <- predict(Calcium_svm_model, newdata = test_data)
Calcium_svm_accuracy <- sum(Calcium_svm_predictions == test_data$Calcium_balance) / nrow(test_data)
table(Calcium_svm_predictions,test_data$Calcium_balance)
print(Calcium_svm_accuracy)
```

Potassium --- Random Forest
```{r}
train_data$Potassium_balance<-as.factor(train_data$Potassium_balance)
test_data$Potassium_balance<-as.factor(test_data$Potassium_balance)
rf_model_Potassium<- randomForest(Potassium_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish,data=train_data,ntree = 50, mtry = 4)
predictions_Potassium <- predict(rf_model_Potassium, newdata = test_data)
conf_matrix_Potassium <- table(predictions_Potassium, test_data$Potassium_balance)
print(conf_matrix_Potassium)
correct_predictions <- sum(diag(conf_matrix_Potassium))
total_predictions <- sum(conf_matrix_Potassium)
accuracy <- correct_predictions / total_predictions
print(paste("Accuracy:", accuracy))
```

Potassium --- logistic 
```{r}
train_data$Potassium_weight <- 1
for (i in 1:nrow(train_data)){ 
   if (train_data$Potassium_balance[i] == "High") {
    train_data$Potassium_weight[i]<- 6.5
   }
   if (train_data$Potassium_balance[i] == "Low") {
    train_data$Potassium_weight[i]<- 2
  }
} 
Potassium_logistic_model <- multinom(Potassium_balance~shellfish+shrimp_crab+seafish+freshwaterfish, data = train_data, weight =train_data$Potassium_weight)
Potassium_logistic_predictions <- predict(Potassium_logistic_model, newdata = test_data)
Potassium_conf_matrix_logistic <- table(Potassium_logistic_predictions, test_data$Potassium_balance)
print(Potassium_conf_matrix_logistic)
sum(Potassium_logistic_predictions==test_data$Potassium_balance)/(nrow(test_data))
```

Potassium --- Naive Bayes
```{r}
Potassium_naive_bayes <- naiveBayes(Potassium_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish,data = train_data)
Potassium_nb_predictions <- predict(Potassium_naive_bayes, newdata = test_data)
Potassium_conf_matrix <- table(Potassium_nb_predictions, test_data$Potassium_balance)
sum(diag(Potassium_conf_matrix)) / sum(Potassium_conf_matrix)
print(Potassium_conf_matrix)
```

Potassium --- SVM
```{r}
Potassium_weights <- c(Balance = 1, High = 6.5, Low = 2)
Potassium_svm_model <- svm(Potassium_balance ~ shellfish+shrimp_crab+seafish+freshwaterfish, data = train_data, kernel = "radial", type = "C-classification",class.weights = Potassium_weights)
Potassium_svm_predictions <- predict(Potassium_svm_model, newdata = test_data)
Potassium_svm_accuracy <- sum(Potassium_svm_predictions == test_data$Potassium_balance) / nrow(test_data)
table(Potassium_svm_predictions,test_data$Potassium_balance)
print(Potassium_svm_accuracy)
```

````stop```````````





```{r}
class_weights_1 <- table(train_data$balance)
class_weights_1 <- 1 / class_weights_1
train_data$balance<-as.factor(train_data$balance)
test_data$balance<-as.factor(test_data$balance)
rf_model_1<- randomForest(x=train_data[c("shellfish","shrimp_crab","seafish","freshwaterfish")],y=train_data$balance, ntree = 100, classwt = class_weights_1)
predictions_1 <- predict(rf_model_1, newdata = test_data)
conf_matrix_1 <- confusionMatrix(predictions_1, test_data$balance)
print(conf_matrix_1)
accuracy_1 <- conf_matrix_1$overall["Accuracy"]
print(paste("Accuracy:", accuracy_1))
```



```{r}
train_data$balance_2<-as.factor(train_data$balance_2)
test_data$balance_2<-as.factor(test_data$balance_2)
rf_model_2<- randomForest(x=train_data[c("shellfish","shrimp_crab","seafish","freshwaterfish")],y=train_data$balance_2, ntree = 100)
predictions_2 <- predict(rf_model_2, newdata = test_data)
conf_matrix_2 <- confusionMatrix(predictions_2, test_data$balance)
print(conf_matrix_2)
accuracy_2 <- conf_matrix_2$overall["Accuracy"]
print(paste("Accuracy:", accuracy_2))
```


```{r}
data_long <- tidyr::gather(sub_df, key = "variable", value = "class", Zinc_balance,Potassium_balance,Calcium_balance)

# Calculate the percentage of each class for each variable
class_percentages <- prop.table(table(data_long$variable, data_long$class), margin = 1) * 100

# Create a bar plot
ggplot(data = data_long, aes(x = variable, fill = class)) +
  geom_bar(position = "fill") +
  labs(title = "Class Distribution for Each Trace Elements",
       x = "Variable", y = "Percentage") +
  theme_minimal()
```
```{r}
double_data <- sub_df[c("Zinc_balance","Calcium_balance","Iron_balance", "Potassium_balance")]
convert_to_numeric <- function(x) {
  as.numeric(factor(x, levels = c("High", "Low", "Balance")))}
df_numeric <- data.frame(lapply(double_data, convert_to_numeric))
df_numeric$shellfish <- sub_df$shellfish
df_numeric$shrimp_crab <- sub_df$shrimp_crab
df_numeric$seafish <- sub_df$seafish
df_numeric$freshwaterfish <- sub_df$freshwaterfish

cor(df_numeric)
cor_matrix <- cor(df_numeric, use = "complete.obs")
melted_cor_matrix <- melt(cor_matrix)
ggplot(data = melted_cor_matrix, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1,1), space = "Lab", 
                       name="Pearson\nCorrelation") +
  theme_minimal() +
  coord_fixed() +
  xlab("") +
  ylab("") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
```{r}
double_data <- sub_df[c("Fiber_balance","Protein_balance","Fat_balance", "Carbohydrate_balance")]
convert_to_numeric <- function(x) {
  as.numeric(factor(x, levels = c("High", "Low", "Balance")))}
df_numeric <- data.frame(lapply(double_data, convert_to_numeric))
df_numeric$shellfish <- sub_df$shellfish
df_numeric$shrimp_crab <- sub_df$shrimp_crab
df_numeric$seafish <- sub_df$seafish
df_numeric$freshwaterfish <- sub_df$freshwaterfish

cor(df_numeric)
cor_matrix <- cor(df_numeric, use = "complete.obs")
melted_cor_matrix <- melt(cor_matrix)
ggplot(data = melted_cor_matrix, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1,1), space = "Lab", 
                       name="Pearson\nCorrelation") +
  theme_minimal() +
  coord_fixed() +
  xlab("") +
  ylab("") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


```{r}
minimal_model <- glm(Protein_balance ~ 1, data = df_numeric)

full_model <- glm(Protein_balance ~ shellfish + shrimp_crab + seafish +freshwaterfish, data = df_numeric)

stepwise_model <- step(minimal_model, scope = list(lower = minimal_model, upper = full_model), direction = "forward")

summary(stepwise_model)

stepwise_model_predictions <- predict(stepwise_model, newdata = test_data)
Zinc_conf_matrix_logistic <- table(stepwise_model_predictions, test_data$Protein_balance)
print(Zinc_conf_matrix_logistic)
print(paste("Accurate:",1-sum(Zinc_logistic_predictions==test_data$Protein_balance)/(nrow(test_data))))
predictions <- predict(Zinc_logistic_model, newdata = test_data)
conf_matrix <- table(test_data$Protein_balance, predictions)
kappa_stat <- kappam.fleiss(conf_matrix)$value
print(paste("kappa:", kappa_stat))
```



```{r}
Protein <- glm(Protein_balance ~ shellfish + shrimp_crab + seafish +freshwaterfish, data = df_numeric)

double_data <- sub_df[c("Zinc_balance","Calcium_balance","Iron_balance", "Potassium_balance")]
convert_to_numeric <- function(x) {
  as.numeric(factor(x, levels = c("High", "Low", "Balance")))}
df_numeric_2 <- data.frame(lapply(double_data, convert_to_numeric))
df_numeric_2$shellfish <- sub_df$shellfish
df_numeric_2$shrimp_crab <- sub_df$shrimp_crab
df_numeric_2$seafish <- sub_df$seafish
df_numeric_2$freshwaterfish <- sub_df$freshwaterfish


Zinc <- glm(Zinc_balance ~ shellfish + shrimp_crab + seafish +freshwaterfish, data = df_numeric_2)

summary(Protein)
summary(Zinc)
```